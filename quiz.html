<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historia - Quiz</title>
    <link rel="stylesheet" href="style_quiz.css">
</head>
<body>
    <h1>Historia - Quiz </h1>
    <a href="index.html" class="nav-back">Wr贸 do Galerii </a>

    <!-- Setup View -->
    <div id="setup-container" class="quiz-container">
        <h2>Ustawienia Quizu</h2>
        <div class="form-group">
            <label for="question-count">Liczba pyta:</label>
            <input type="number" id="question-count" min="1" max="50" value="10">
        </div>
        <div class="form-group">
            <label for="quiz-mode">Tryb Gry:</label>
            <select id="quiz-mode">
                <option value="date-to-event">Mam DAT, zgaduj wydarzenie</option>
                <option value="event-to-date">Mam WYDARZENIE, zgaduj dat</option>
            </select>
        </div>
        <button id="start-btn">Rozpocznij Quiz </button>
    </div>

    <!-- Quiz View -->
    <div id="quiz-container" class="quiz-container" style="display: none;">
        <div class="progress">Pytanie <span id="current-q">1</span> / <span id="total-q">10</span></div>
        <div class="question-area">
             <div id="quiz-question" class="question-text">Pytanie</div>
        </div>
        <div id="options-area" class="options-grid">
            <!-- Buttons generated via JS -->
        </div>
        <div id="feedback" class="feedback"></div>
    </div>

    <!-- Result View -->
    <div id="result-container" class="quiz-container" style="display: none;">
        <h2>Koniec Quizu! </h2>
        <p>Tw贸j wynik: <span id="score">0</span> / <span id="final-total">0</span></p>
        <button id="restart-btn">Zagraj ponownie</button>
    </div>

    <script src="data.js"></script>
    <script>
        // LOGIKA QUIZU
        
        let quizQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let isAnswering = false;

        const setupContainer = document.getElementById('setup-container');
        const quizContainer = document.getElementById('quiz-container');
        const resultContainer = document.getElementById('result-container');

        const quizQuestionText = document.getElementById('quiz-question');
        const optionsArea = document.getElementById('options-area');
        const currentQSpan = document.getElementById('current-q');
        const totalQSpan = document.getElementById('total-q');
        const feedbackDiv = document.getElementById('feedback');

        const scoreSpan = document.getElementById('score');
        const finalTotalSpan = document.getElementById('final-total');

        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');

        startBtn.addEventListener('click', startQuiz);
        restartBtn.addEventListener('click', () => {
            resultContainer.style.display = 'none';
            setupContainer.style.display = 'flex';
        });

        function startQuiz() {
            const countInput = document.getElementById('question-count');
            const modeSelect = document.getElementById('quiz-mode');
            
            let count = parseInt(countInput.value);
            const mode = modeSelect.value; // 'date-to-event' or 'event-to-date'

            if (count > eventData.length) count = eventData.length;
            if (count < 1) count = 1;

            quizQuestions = generateQuestions(count, mode);
            currentQuestionIndex = 0;
            score = 0;

            setupContainer.style.display = 'none';
            quizContainer.style.display = 'flex';
            
            renderQuestion();
        }

        function generateQuestions(count, mode) {
            // Tasujemy wydarzenia, 偶eby wybra pytania
            const shuffledEvents = shuffleArray([...eventData]);
            const selectedEvents = shuffledEvents.slice(0, count);

            return selectedEvents.map(item => {
                let questionText, correctAnswer, distractorPool;
                
                if (mode === 'date-to-event') {
                    questionText = `Co wydarzyo si w roku ${item.date}?`;
                    correctAnswer = item.event;
                    // Bdne odpowiedzi to inne wydarzenia
                    distractorPool = eventData.map(e => e.event).filter(e => e !== correctAnswer);
                } else {
                    questionText = `W kt贸rym roku byo: ${item.event}?`;
                    correctAnswer = item.date;
                    // Bdne odpowiedzi to inne daty
                    distractorPool = [...new Set(eventData.map(e => e.date))].filter(d => d !== correctAnswer);
                }

                // Losujemy 3 bdne odpowiedzi
                const distractors = shuffleArray(distractorPool).slice(0, 3);
                
                // Dokadamy poprawn i tasujemy opcje
                const options = shuffleArray([correctAnswer, ...distractors]);
                
                return {
                    question: questionText,
                    correctAnswer: correctAnswer,
                    options: options
                };
            });
        }

        function renderQuestion() {
            isAnswering = true;
            feedbackDiv.innerText = "";
            optionsArea.innerHTML = "";
            
            const q = quizQuestions[currentQuestionIndex];
            
            quizQuestionText.innerText = q.question;
            currentQSpan.innerText = currentQuestionIndex + 1;
            totalQSpan.innerText = quizQuestions.length;

            // Sprawdzamy czy odpowiedzi s dugie (dla ukadu siatki)
            // Jeli odpowiedzi to daty (kr贸tkie), mo偶e by siatka 2 kolumny
            // Jeli odpowiedzi to wydarzenia (dugie), lepiej 1 kolumna
            const isLongText = q.options.some(opt => opt.length > 10);
            if (isLongText) {
                optionsArea.classList.remove('grid-2-col');
            } else {
                optionsArea.classList.add('grid-2-col');
            }

            q.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.classList.add('option-btn');
                btn.innerText = opt;
                btn.onclick = () => handleAnswer(btn, opt, q.correctAnswer);
                optionsArea.appendChild(btn);
            });
        }

        function handleAnswer(btn, selected, correct) {
            if (!isAnswering) return;
            isAnswering = false;

            const allBtns = optionsArea.querySelectorAll('button');

            if (selected === correct) {
                score++;
                btn.classList.add('correct');
                feedbackDiv.innerText = "Dobrze! ";
                feedbackDiv.style.color = "#28a745";
            } else {
                btn.classList.add('wrong');
                feedbackDiv.innerText = "殴le  Prawidowa odpowied藕 to: " + correct;
                feedbackDiv.style.color = "#dc3545";
                
                // Poka偶 poprawn
                allBtns.forEach(b => {
                    if (b.innerText === correct) b.classList.add('correct');
                });
            }

            // Nastpne pytanie po op贸藕nieniu
            setTimeout(() => {
                currentQuestionIndex++;
                if (currentQuestionIndex < quizQuestions.length) {
                    renderQuestion();
                } else {
                    showResults();
                }
            }, 2500);
        }

        function showResults() {
            quizContainer.style.display = 'none';
            resultContainer.style.display = 'flex';
            scoreSpan.innerText = score;
            finalTotalSpan.innerText = quizQuestions.length;
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

    </script>
</body>
</html>
